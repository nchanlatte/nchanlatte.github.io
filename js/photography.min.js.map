{"version":3,"sources":["photography.js"],"names":["const","resetViewer","func","wait","immediate","timeout","viewer","document","querySelector","preload","url","cb","loader","Image","onload","src","loadThumbnail","img","getBoundingClientRect","top","window","innerHeight","urlThumb","getAttribute","style","backgroundImage","classList","remove","closeViewer","add","setTimeout","width","height","left","Array","prototype","slice","call","querySelectorAll","forEach","urlPreview","setAttribute","addEventListener","e","clearTimeout","urlFull","pos","clientHeight","openViewer","preventDefault","context","this","args","arguments","callNow","apply","keyCode","contains"],"mappings":"CAAA,WACEA,IAMIC,EA8BcC,EAAMC,EAAMC,EACxBC,EAjCAC,EAASC,SAASC,cAAc,mBA+CtC,SAASC,EAAQC,EAAKC,GACpBX,IAAMY,EAAS,IAAIC,MACnBD,EAAOE,OAASH,EAChBC,EAAOG,IAAML,EAQf,SAASM,EAAcC,GACrB,GAAIA,EAAIC,wBAAwBC,IAAMC,OAAOC,YAAc,IAAK,CAC9DrB,IAAMsB,EAAWL,EAAIM,aAAa,cAClCd,EAAQa,EAAQ,WACdL,EAAIO,MAAMC,gBAAkB,OAAAH,EAAO,IACnCL,EAAIS,UAAUC,OAAO,6BAgC3B,SAASC,IACPtB,EAAOoB,UAAUG,IAAI,2BACrBvB,EAAOoB,UAAUC,OAAO,wBAExB1B,EAAc6B,WAAU,WACtBxB,EAAOoB,UAAUC,OAAO,2BACxBrB,EAAOkB,MAAMC,gBAAkB,GAC/BnB,EAAOkB,MAAMO,MAAQ,GACrBzB,EAAOkB,MAAMQ,OAAS,GACtB1B,EAAOkB,MAAML,IAAM,GACnBb,EAAOkB,MAAMS,KAAO,IACnB,KAzGQC,MAAMC,UAAUC,MAAMC,KAAK9B,SAAS+B,iBAAiB,mBAG7DC,QAAO,SAAAtB,GACVjB,IAAMwC,EAAavB,EAAIM,aAAa,gBAEpCN,EAAIS,UAAUG,IAAI,0BAClBpB,EAAQ+B,EAAU,WACZvB,EAAIM,aAAa,eAbA,IAcnBN,EAAIO,MAAMC,gBAAkB,OAAAe,EAAO,IACnCvB,EAAIwB,aAAa,cAfE,GAgBnBzB,EAAcC,MAIlBA,EAAIyB,iBAAiB,QAAO,SAAAC,IAoD9B,SAAoB1B,GAClB2B,aAAa3C,GACbD,IAAMsB,EAAWL,EAAIM,aAAa,cAC5BsB,EAAU5B,EAAIM,aAAa,aAE7BN,EAAIM,aAAa,eA3ED,GA4ElBjB,EAAOkB,MAAMC,gBAAkB,OAAAH,EAAO,IAEtCb,EAAQoC,EAAO,WACbf,WAAU,WACRxB,EAAOkB,MAAMC,gBAAkB,OAAAoB,EAAO,IACtC5B,EAAIwB,aAAa,cAjFH,IAkFb,QAGLnC,EAAOkB,MAAMC,gBAAkB,OAAAoB,EAAO,IAGxC7C,IAAM8C,EAAM7B,EAAIC,wBAChBZ,EAAOkB,MAAMO,MAAQe,EAAIf,MAAQ,KACjCzB,EAAOkB,MAAMQ,OAASc,EAAId,OAAS,KACnC1B,EAAOkB,MAAML,IAAM2B,EAAI3B,IAAM,KAC7Bb,EAAOkB,MAAMS,KAAOa,EAAIb,KAAO,KAC/B3B,EAAOyC,aACPzC,EAAOoB,UAAUG,IAAI,wBA3EnBmB,CAAW/B,GACX0B,EAAEM,qBAIN3C,EAAOoC,iBAAiB,QAASd,GACjCR,OAAOsB,iBAAiB,UASNxC,EAqBlB,WACegC,MAAMC,UAAUC,MAAMC,KAAK9B,SAAS+B,iBAAiB,sBAC7DC,QAAQvB,IAvBSb,EATmC,GAWlD,WACL,IAAI+C,EAAUC,KAAMC,EAAOC,UAKvBC,EAAUlD,IAAcC,EAC5BuC,aAAavC,GACbA,EAAUyB,WANE,WACVzB,EAAU,KACLD,GAASF,EAAEqD,MAAKL,EAAaE,IAIRjD,GACxBmD,GAAOpD,EAAEqD,MAAKL,EAAaE,MAlBnC7C,SAASmC,iBAAiB,QAAO,SAAAC,GACb,KAAdA,EAAEa,SAAkBlD,EAAOoB,UAAU+B,SAAS,0BAChD7B,IACAe,EAAEM,oBAjCR","file":"photography.min.js","sourcesContent":["(() => {\n  const LOADED_PREVIEW = 1;\n  const LOADED_THUMB = 2;\n  const LOADED_FULL = 3;\n\n  const viewer = document.querySelector('.Gallery-viewer');\n  const imgs = Array.prototype.slice.call(document.querySelectorAll('[data-preview]'));\n  let resetViewer;\n  \n  imgs.forEach((img) => {\n    const urlPreview = img.getAttribute('data-preview');\n  \n    img.classList.add('Gallery-image--preview');\n    preload(urlPreview, () => {\n      if (img.getAttribute('data-loaded') < LOADED_PREVIEW) {\n        img.style.backgroundImage = `url(${urlPreview})`;\n        img.setAttribute('data-loaded', LOADED_PREVIEW);\n        loadThumbnail(img);\n      }\n    });\n  \n    img.addEventListener('click', (e) => {\n      openViewer(img);\n      e.preventDefault();\n    });\n  });\n  \n  viewer.addEventListener('click', closeViewer);\n  window.addEventListener('scroll', debounce(loadThumbnails, 50));\n\n  document.addEventListener('keyup', (e) => {\n    if (e.keyCode === 27 && viewer.classList.contains('Gallery-viewer--open')) {\n      closeViewer();\n      e.preventDefault();\n    }\n  });\n  \n  function debounce(func, wait, immediate) {\n    var timeout;\n    return function() {\n      var context = this, args = arguments;\n      var later = function() {\n        timeout = null;\n        if (!immediate) func.apply(context, args);\n      };\n      var callNow = immediate && !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n      if (callNow) func.apply(context, args);\n    };\n  }\n  \n  function preload(url, cb) {\n    const loader = new Image();\n    loader.onload = cb;\n    loader.src = url;\n  }\n  \n  function loadThumbnails() {\n    const imgs = Array.prototype.slice.call(document.querySelectorAll(`[data-loaded=\"${LOADED_PREVIEW}\"]`));\n    imgs.forEach(loadThumbnail);\n  }\n\n  function loadThumbnail(img) {\n    if (img.getBoundingClientRect().top < window.innerHeight + 500) {\n      const urlThumb = img.getAttribute('data-thumb');\n      preload(urlThumb, () => {\n        img.style.backgroundImage = `url(${urlThumb})`;\n        img.classList.remove('Gallery-image--preview');\n      });\n    }\n  }\n\n  function openViewer(img) {\n    clearTimeout(resetViewer);\n    const urlThumb = img.getAttribute('data-thumb');\n    const urlFull = img.getAttribute('data-full');\n\n    if (img.getAttribute('data-loaded') < LOADED_FULL) {\n      viewer.style.backgroundImage = `url(${urlThumb})`;\n\n      preload(urlFull, () => {\n        setTimeout(() => {\n          viewer.style.backgroundImage = `url(${urlFull})`;\n          img.setAttribute('data-loaded', LOADED_FULL);\n        }, 500);\n      });\n    } else {\n      viewer.style.backgroundImage = `url(${urlFull})`;\n    }\n\n    const pos = img.getBoundingClientRect();\n    viewer.style.width = pos.width + 'px';\n    viewer.style.height = pos.height + 'px';\n    viewer.style.top = pos.top + 'px';\n    viewer.style.left = pos.left + 'px';\n    viewer.clientHeight;\n    viewer.classList.add('Gallery-viewer--open');\n  }\n\n  function closeViewer() {\n    viewer.classList.add('Gallery-viewer--closing');\n    viewer.classList.remove('Gallery-viewer--open');\n  \n    resetViewer = setTimeout(() => {\n      viewer.classList.remove('Gallery-viewer--closing');\n      viewer.style.backgroundImage = '';\n      viewer.style.width = '';\n      viewer.style.height = '';\n      viewer.style.top = '';\n      viewer.style.left = '';\n    }, 500);\n  }\n})();\n"]}